<!DOCTYPE html>
<html class="dark" lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TiketGo — Pencarian</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <style>
    :root{--bg:#0f0f10;--muted:#9ca3af;--accent:#ea2a33}
    .material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24}
    body{font-family:"Plus Jakarta Sans",sans-serif;background:var(--bg);color:#fff;min-height:100dvh}
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <header class="sticky top-0 z-30 bg-[rgba(10,10,10,0.9)] px-4 py-3 border-b border-white/6">
    <div class="flex gap-3 items-center">
      <a href="Beranda.html" class="p-2"><span class="material-symbols-outlined">arrow_back</span></a>
      <input id="searchInput" placeholder="Cari acara, artis, lokasi..." class="flex-1 rounded-xl bg-[rgba(255,255,255,0.03)] px-4 py-2 focus:outline-none" />
      <a href="keranjang.html" class="relative p-2 ml-2">
        <span class="material-symbols-outlined">shopping_cart</span>
        <span id="cartBadgeTop" class="absolute -top-1 -right-1 min-w-[18px] h-4 px-1 rounded-full text-xs text-black bg-[--accent] flex items-center justify-center hidden">0</span>
      </a>
    </div>
    <div class="mt-3 flex gap-2 overflow-auto">
      <button data-cat="" class="filterBtn px-3 py-1 rounded-full text-sm bg-white/6">Semua</button>
      <button data-cat="Musik" class="filterBtn px-3 py-1 rounded-full text-sm bg-white/6">Musik</button>
      <button data-cat="Olahraga" class="filterBtn px-3 py-1 rounded-full text-sm bg-white/6">Olahraga</button>
      <button data-cat="Festival" class="filterBtn px-3 py-1 rounded-full text-sm bg-white/6">Festival</button>
      <button data-cat="Seni" class="filterBtn px-3 py-1 rounded-full text-sm bg-white/6">Seni</button>
    </div>
  </header>

  <main class="flex-1 overflow-y-auto px-4 py-4 pb-36">
    <div id="resultsInfo" class="text-sm text-[--muted] mb-3"></div>
    <div id="resultsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
    <div id="noResults" class="hidden text-center text-[--muted] mt-6">Tidak ada hasil</div>
  </main>

  <!-- Bottom Navbar -->
  <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 z-40 w-[min(98%,1200px)] bg-[rgba(10,10,10,0.95)] border border-white/6 rounded-2xl flex justify-between px-4 py-2 items-center">
    <a href="Beranda.html" class="flex flex-col items-center text-white/80 hover:text-[--accent]"><span class="material-symbols-outlined">home</span><span class="text-xs">Beranda</span></a>
    <a href="Pencarian.html" class="flex flex-col items-center text-[--accent]"><span class="material-symbols-outlined">search</span><span class="text-xs">Cari</span></a>
    <a href="tiket.html" class="flex flex-col items-center text-white/80 hover:text-[--accent]"><span class="material-symbols-outlined">confirmation_number</span><span class="text-xs">Tiket</span></a>
    <a href="keranjang.html" class="flex flex-col items-center text-white/80 hover:text-[--accent] relative">
      <span class="material-symbols-outlined">shopping_cart</span>
      <span id="cartBadgeNav" class="absolute -top-2 -right-2 min-w-[18px] h-4 px-1 rounded-full text-xs text-black bg-[--accent] flex items-center justify-center hidden">0</span>
      <span class="text-xs">Keranjang</span>
    </a>
    <a href="#" class="flex flex-col items-center text-white/80 hover:text-[--accent]"><span class="material-symbols-outlined">person</span><span class="text-xs">Akun</span></a>
  </nav>

  <script>
    // EVENTS same data
    const EVENTS = [
      {id:1, title:"International Music Fest", date:"31 Des 2024", location:"GBK Stadium", price:350000, img:"https://images.unsplash.com/photo-1506157786151-b8491531f063?q=80&w=1200&auto=format&fit=crop", category:"Musik", desc:"Festival musik internasional."},
      {id:2, title:"Rock Legends Live", date:"15 Des 2024", location:"Istora", price:250000, img:"https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?q=80&w=1200&auto=format&fit=crop", category:"Musik", desc:"Konser rock."},
      {id:3, title:"City Marathon", date:"18 Des 2024", location:"Jakarta", price:150000, img:"https://images.unsplash.com/photo-1551974740-3657c859cee3?q=80&w=1200&auto=format&fit=crop", category:"Olahraga", desc:"Lomba lari kota."},
      {id:4, title:"Jazz Night Special", date:"1 Jan 2025", location:"Candra", price:120000, img:"https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1200&auto=format&fit=crop", category:"Musik", desc:"Malam jazz."},
      {id:5, title:"Culinary Festival", date:"28 Des 2024", location:"Car Free Day", price:80000, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop", category:"Festival", desc:"Festival kuliner."},
      {id:6, title:"Art & Soul Exhibition", date:"22 Des 2024", location:"Galeri Nasional", price:60000, img:"https://images.unsplash.com/photo-1512453979798-5ea266f8880c?q=80&w=1200&auto=format&fit=crop", category:"Seni", desc:"Pameran seni."},
      {id:7, title:"EDM Night Out", date:"29 Des 2024", location:"Club X", price:200000, img:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=1200&auto=format&fit=crop", category:"Musik", desc:"Pesta EDM."},
      {id:8, title:"Theatre Classics", date:"30 Des 2024", location:"Teater Kota", price:90000, img:"https://images.unsplash.com/photo-1504036190944-95e9a4f5a35c?q=80&w=1200&auto=format&fit=crop", category:"Teater", desc:"Drama klasik."},
      {id:9, title:"Indie Vibes", date:"12 Jan 2025", location:"Cafe Hall", price:70000, img:"https://images.unsplash.com/photo-1520975912609-0f1b3738f7a8?q=80&w=1200&auto=format&fit=crop", category:"Musik", desc:"Indie showcase."},
      {id:10, title:"Food Truck Fiesta", date:"5 Jan 2025", location:"Park", price:50000, img:"https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop", category:"Festival", desc:"Kumpulan food truck."}
    ];

    // cart badge
    const CART_KEY = 'tiketgo_cart';
    function getCart(){ try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]')}catch(e){return []} }
    function updateBadges(){
      const top = document.getElementById('cartBadgeTop');
      const nav = document.getElementById('cartBadgeNav');
      const c = getCart();
      const total = c.reduce((s,i)=>s+(i.qty||0),0);
      if(total>0){ if(top) top.textContent = total, top.classList.remove('hidden'); if(nav) nav.textContent = total, nav.classList.remove('hidden'); }
      else { if(top) top.classList.add('hidden'); if(nav) nav.classList.add('hidden'); }
    }

    function numberWithDots(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    const input = document.getElementById('searchInput');
    const resultsGrid = document.getElementById('resultsGrid');
    const resultsInfo = document.getElementById('resultsInfo');
    const noResults = document.getElementById('noResults');

    // initial query from ?q=
    const params = new URLSearchParams(location.search);
    const initialQ = params.get('q') || '';
    if(initialQ) input.value = initialQ;

    function render(list, q){
      resultsGrid.innerHTML = '';
      if(!list.length){ noResults.classList.remove('hidden'); resultsInfo.textContent = `0 hasil${q?(' untuk "'+q+'"'):''}`; return; }
      noResults.classList.add('hidden');
      resultsInfo.textContent = `${list.length} hasil${q?(' untuk "'+q+'"'):''}`;
      list.forEach(ev=>{
        const a = document.createElement('div');
        a.className = 'block rounded-lg overflow-hidden bg-[rgba(255,255,255,0.02)] flex flex-col';
        a.innerHTML = `
          <a href="Detail.html?id=${ev.id}" class="block w-full aspect-[4/5] overflow-hidden"><img src="${ev.img}" alt="${escapeHtml(ev.title)}" class="w-full h-full object-cover"/></a>
          <div class="p-2 flex-1 flex flex-col">
            <div class="flex-1">
              <p class="text-sm font-semibold leading-tight">${escapeHtml(ev.title)}</p>
              <p class="text-xs text-[--muted]">${ev.date} • ${escapeHtml(ev.location)}</p>
            </div>
            <div class="mt-2 flex items-center justify-between gap-2">
              <div class="text-sm font-bold text-[--accent]">Rp ${numberWithDots(ev.price)}</div>
              <div class="flex gap-2">
                <button onclick="addToCart(${ev.id})" class="px-3 py-1 rounded bg-white/6 text-sm">Tambah</button>
                <a href="Detail.html?id=${ev.id}" class="px-3 py-1 rounded bg-[--accent] text-sm">Detail</a>
              </div>
            </div>
          </div>
        `;
        resultsGrid.appendChild(a);
      });
    }

    function filterEvents(q='', category=''){
      q = (q||'').toLowerCase().trim();
      let res = EVENTS.filter(ev=>{
        const hay = (ev.title + ' ' + ev.location + ' ' + ev.category + ' ' + ev.desc).toLowerCase();
        return (!q || hay.includes(q)) && (!category || ev.category===category);
      });
      render(res, q);
    }

    // add to cart (shared logic)
    function addToCart(id, qty=1){
      const ev = EVENTS.find(e=>e.id===Number(id));
      if(!ev) return alert('Event tidak ditemukan');
      const c = getCart();
      const item = c.find(i=>i.id===ev.id);
      if(item) item.qty += qty; else c.push({id:ev.id, title:ev.title, price:ev.price, qty, img:ev.img});
      localStorage.setItem(CART_KEY, JSON.stringify(c));
      updateBadges();
    }

    // interactions
    input.addEventListener('input', (e)=>{ filterEvents(e.target.value, activeCategory || ''); const up = new URL(location); up.searchParams.set('q', e.target.value); history.replaceState({},'', up); });
    document.querySelectorAll('.filterBtn').forEach(btn=> btn.addEventListener('click', ()=>{ document.querySelectorAll('.filterBtn').forEach(b=>b.classList.remove('bg-[rgba(255,255,255,0.12)]')); btn.classList.add('bg-[rgba(255,255,255,0.12)]'); activeCategory = btn.dataset.cat || ''; filterEvents(input.value || initialQ, activeCategory); }));
    let activeCategory = '';

    // init
    filterEvents(initialQ, '');
    updateBadges();
    window.addEventListener('storage', (e)=>{ if(e.key === CART_KEY) updateBadges(); });
  </script>
</body>
</html>
